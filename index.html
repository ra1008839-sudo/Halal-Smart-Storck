<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Halal Smart Stock</title>
<meta name="theme-color" content="#0ea35a" />
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<style>
/* Simple safe inline styles â€” copy/paste-safe */
:root{--brand:#0ea35a;--bg1:#0b2f22;--text:#f3fff7}
*{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#082b1e,#072114);color:var(--text)}
.header{display:flex;align-items:center;gap:12px;padding:12px 16px;background:rgba(255,255,255,0.04);position:sticky;top:0}
.logo{width:44px;height:44px;border-radius:8px;background:#fff;color:var(--brand);display:flex;align-items:center;justify-content:center;font-weight:800}
.title{font-size:18px;margin:0}
.container{max-width:980px;margin:14px auto;padding:0 12px}
.row{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
.card{background:rgba(255,255,255,0.03);padding:12px;border-radius:12px}
.small{font-size:13px;color:rgba(255,255,255,0.8)}
.btn{background:var(--brand);border:0;color:#fff;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.08)}
.userpill{display:flex;gap:8px;align-items:center;background:rgba(0,0,0,0.2);padding:4px 8px;border-radius:999px}
.splash{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0ea35a,#067a3f);z-index:9999}
.hide{display:none}
.footer{padding:18px;text-align:center;color:rgba(255,255,255,0.6)}
.install-hint{font-size:13px;color:rgba(255,255,255,0.7);margin-top:8px}
</style>
</head>
<body>

<!-- Splash (3s) -->
<div id="splash" class="splash">
  <div style="background:#fff;padding:20px;border-radius:12px;color:#0b2f22;text-align:center">
    <h1 style="margin:0;font-size:28px">Bismillah</h1>
    <div class="small">Halal Smart Stock</div>
  </div>
</div>

<div id="app" class="hide">
  <header class="header">
    <div class="logo">H</div>
    <div>
      <div class="title">Halal Smart Stock</div>
      <div class="small">Iman + Investing</div>
    </div>
    <div id="auth-slot" style="margin-left:auto"></div>
  </header>

  <main class="container">
    <!-- Quick actions -->
    <section class="card">
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button id="shareBtn" class="btn">Share on WhatsApp</button>
        <button id="refreshBtn" class="btn ghost">Refresh Data</button>
        <button id="installBtn" class="btn ghost hide">Install App</button>
      </div>
      <div class="install-hint">Share this link on WhatsApp. Users can open and Add to Home Screen (PWA) â€” no Play Store required.</div>
    </section>

    <!-- Features grid -->
    <section class="row" style="margin-top:12px">
      <div class="card">
        <h3 style="margin:0 0 6px">GPT Power</h3>
        <div id="gptTop" class="small">Loading demo picksâ€¦</div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 6px">Trailing Stop Loss (Demo)</h3>
        <div id="trailBox" class="small">Use simulator after deploy.</div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 6px">Halal Stock List</h3>
        <ul id="halalList" class="small">
          <li>TCS</li><li>INFY</li><li>HDFCBANK</li><li>ITC</li>
        </ul>
      </div>

      <div class="card">
        <h3 style="margin:0 0 6px">Markets (Demo)</h3>
        <div id="indicesBox" class="small">NIFTY: â€” â€¢ BANKNIFTY: â€” â€¢ SENSEX: â€”</div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 6px">18-Hour News (Demo)</h3>
        <div id="newsBox" class="small">No live feed yet. Press Refresh.</div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 6px">FII / DII Signals (Demo)</h3>
        <div class="small">Institutional flow sample data.</div>
      </div>
    </section>
  </main>

  <footer class="footer">Â© <span id="year"></span> Halal Smart Stock â€” Share via WhatsApp</footer>
</div>

<!-- modal -->
<div id="modal" style="display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,0.5)">
  <div id="modalContent" style="background:#fff;color:#000;padding:14px;border-radius:8px;max-width:720px;margin:0 12px"></div>
</div>

<!-- Firebase SDKs (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
/* ----------------- CONFIGURE FIREBASE -----------------
  1) Go to https://console.firebase.google.com -> Create project
  2) In Firebase Console -> Build -> Authentication -> Sign-in method -> Enable Google
  3) Project settings -> Your apps -> Add Web app -> copy config object
  4) Replace the placeholders below with your values
*/
const FIREBASE_CONFIG = {
  apiKey: "REPLACE_API_KEY",
  authDomain: "REPLACE_PROJECT.firebaseapp.com",
  projectId: "REPLACE_PROJECT_ID",
  storageBucket: "REPLACE_PROJECT.appspot.com",
  messagingSenderId: "REPLACE_SENDER_ID",
  appId: "REPLACE_APP_ID"
};

/* --------------- UI: splash -> app ------------------ */
document.getElementById('year').textContent = new Date().getFullYear();
setTimeout(()=>{ document.getElementById('splash').classList.add('hide'); document.getElementById('app').classList.remove('hide'); }, 3000);

/* ---------------- demo fillers -------------------- */
function fillDemo(){
  document.getElementById('gptTop').innerHTML = '<ol><li>INFY â€” 78</li><li>TCS â€” 73</li><li>HDFCBANK â€” 69</li></ol>';
  document.getElementById('indicesBox').textContent = 'NIFTY: 24,500 â€¢ BANKNIFTY: 52,450 â€¢ SENSEX: 80,780';
  document.getElementById('newsBox').innerHTML = '<div>Banking stocks rally (demo)</div><div>Crude steady (demo)</div>';
}
fillDemo();

/* ---------------- WhatsApp share ------------------ */
document.getElementById('shareBtn').addEventListener('click', ()=> {
  const text = ðŸ“ˆ Halal Smart Stock idea\nGPT Top: INFY (78)\nTarling SL demo\nOpen: ${location.href};
  const url = 'https://wa.me/?text=' + encodeURIComponent(text);
  window.open(url,'_blank');
});

/* --------------- PWA install flow ----------------- */
let deferredPrompt = null;
const installBtn = document.getElementById('installBtn');
window.addEventListener('beforeinstallprompt', (e)=> {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.classList.remove('hide');
});
installBtn.addEventListener('click', async ()=>{
  if(!deferredPrompt){ alert('Open in Chrome and try Add to Home Screen there.'); return; }
  deferredPrompt.prompt();
  const choice = await deferredPrompt.userChoice;
  if(choice.outcome === 'accepted') console.log('PWA installed');
  deferredPrompt = null;
});

/* --------------- Firebase Google Login ------------- */
function safeMsg(msg){ const slot=document.getElementById('auth-slot'); if(slot) slot.innerHTML = '<div class="small pill">'+msg+'</div>'; }
(function initAuth(){
  const slot = document.getElementById('auth-slot');
  if(!FIREBASE_CONFIG.apiKey || FIREBASE_CONFIG.apiKey.indexOf('REPLACE_')===0){
    safeMsg('Firebase not configured â€” login disabled');
    window.__HALAL_USER = null;
    return;
  }
  try{
    firebase.initializeApp(FIREBASE_CONFIG);
    const auth = firebase.auth();

    function render(user){
      slot.innerHTML = '';
      if(!user){
        const btn = document.createElement('button'); btn.className='btn'; btn.textContent='Login with Google';
        btn.onclick = async ()=>{
          const provider = new firebase.auth.GoogleAuthProvider();
          // desktop: popup; mobile: redirect fallback
          try{ await auth.signInWithPopup(provider); } catch(e){ try{ await auth.signInWithRedirect(provider); } catch(err){ alert('Login error: '+(err.message||err)); } }
        };
        slot.appendChild(btn);
      } else {
        const wrap = document.createElement('div'); wrap.className='userpill';
        const img = document.createElement('img'); img.src = user.photoURL || ''; img.width=34; img.height=34; img.style.borderRadius='6px';
        const name = document.createElement('div'); name.textContent = user.displayName || user.email; name.style.marginLeft='8px';
        const out = document.createElement('button'); out.className='btn ghost'; out.textContent='Logout'; out.onclick = ()=> auth.signOut();
        wrap.appendChild(img); wrap.appendChild(name); wrap.appendChild(out); slot.appendChild(wrap);
      }
      window.__HALAL_USER = user || null;
    }

    auth.onAuthStateChanged(user => render(user));
  } catch(e){
    console.error('Firebase init error', e);
    safeMsg('Firebase init error');
  }
})();
</script>

<!-- register service worker -->
<script>
if('serviceWorker' in navigator){
  window.addEventListener('load', ()=> {
    navigator.serviceWorker.register('service-worker.js').then(()=>console.log('SW registered')).catch(()=>console.warn('SW failed'));
  });
}
</script>
</body>
</html>
