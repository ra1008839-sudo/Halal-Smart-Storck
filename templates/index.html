<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Halal Smart Stock — Demo</title>
<style>
:root{--brand:#0e7a34;--bg:#f6f7fb;--card:#fff;--border:#e5e7eb;--muted:#6b7280;--ok:#22c55e;--danger:#ef4444}
*{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto;background:var(--bg);color:#111}
.hidden{display:none}

/* Splash */
.splash{display:flex;align-items:center;justify-content:center;height:100vh;background:var(--brand)}
.splash-card{background:#fff;color:var(--brand);border-radius:20px;padding:28px 36px;box-shadow:0 12px 30px rgba(0,0,0,.15);text-align:center}
.splash-card h1{font-size:40px;margin:0 0 6px}
.splash-card p{margin:0;font-weight:600}

/* Shell */
.app{min-height:100vh;display:flex;flex-direction:column}
.topbar{position:sticky;top:0;background:#fff;border-bottom:1px solid #e9e9ef;padding:12px 16px;z-index:5;display:flex;align-items:center;gap:12px}
.logo{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:var(--brand);color:#fff;font-weight:800}
.titles h2{margin:0;font-size:18px}
.titles small{color:var(--muted)}

.quick{display:flex;gap:8px;padding:10px 12px;overflow:auto}
.btn{border:1px solid #d4d7dd;background:#fff;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer}
.btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
.btn.ghost{background:#fff}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;padding:12px}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;cursor:pointer;transition:transform .08s,box-shadow .18s}
.card:hover{transform:translateY(-3px);box-shadow:0 8px 18px rgba(0,0,0,.06)}
.card h3{margin:0 0 8px}
.pill{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;margin-top:6px}
.pill.ok{background:#e6f7ed;color:var(--brand)}
.pill.warn{background:#fff6e5;color:#a05d00}

.dot{display:inline-block;width:12px;height:12px;border-radius:50%;vertical-align:middle;margin-right:6px}
.dot.green{background:var(--ok)} .dot.red{background:var(--danger)}

.dua{margin:8px 12px;background:var(--brand);color:#fff;border-radius:10px;padding:8px 10px;display:flex;gap:8px;align-items:center}
.dua span{background:#fff;color:var(--brand);border-radius:6px;padding:2px 6px;font-weight:700}

.bbar{position:sticky;bottom:0;background:#fff;border-top:1px solid #e9e9ef;display:flex;justify-content:space-around;padding:8px}
.tab{background:none;border:none;padding:8px 10px;font-weight:700}
.tab.active{color:var(--brand)}

/* modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;padding:16px}
.modal-card{background:#fff;border-radius:12px;max-width:720px;width:100%;box-shadow:0 16px 40px rgba(0,0,0,.18);overflow:hidden}
.modal-head{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid #eee}
.modal-body{padding:14px;max-height:65vh;overflow:auto}
.modal-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px 14px;border-top:1px solid #eee}
.close{border:none;background:#f3f4f6;border-radius:10px;padding:6px 10px;cursor:pointer}

.small{font-size:13px;color:var(--muted)}
.table{width:100%;border-collapse:collapse}
.table td,.table th{padding:6px 8px;border-bottom:1px solid #f0f0f0}
.center{display:flex;align-items:center;gap:8px}
</style>
</head>
<body>

<!-- SPLASH -->
<section id="splash" class="splash">
  <div class="splash-card">
    <h1>Bismillah</h1>
    <p>Halal Smart Stock</p>
  </div>
</section>

<!-- APP -->
<div id="app" class="app hidden">
  <header class="topbar">
    <div style="display:flex;gap:12px;align-items:center;">
      <div class="logo">H</div>
      <div class="titles">
        <h2>Halal Smart Stock</h2>
        <small class="small">where imaan meets investing</small>
      </div>
    </div>
    <div style="margin-left:auto" id="auth-slot"></div>
  </header>

  <div class="quick">
    <button class="btn" onclick="openModal('gpt')">GPT Power</button>
    <button class="btn" onclick="openModal('halal')">Halal List</button>
    <button class="btn" onclick="openModal('trail')">Trailing SL</button>
    <button class="btn" onclick="openModal('news')">18h News</button>
    <button class="btn" onclick="openModal('indices')">All Indices</button>
    <button class="btn" onclick="openModal('global')">World / Crude / USD</button>
    <button class="btn" onclick="openModal('fiidi')">FII / DII</button>
  </div>

  <main class="grid" id="cards">
    <article class="card" onclick="openModal('gpt')">
      <h3>GPT Power Indicator</h3>
      <p class="small">Simulated top-3 buy-ready picks. Shows Avoid Mode if safety rules fail.</p>
    </article>

    <article class="card" onclick="openModal('halal')">
      <h3>Halal (Shariah) Stock List</h3>
      <p class="small">Auto-update schedule (demo list shown).</p>
      <div class="pill ok">Compliant</div>
    </article>

    <article class="card" onclick="openModal('trail')">
      <h3>Trailing Stop Loss</h3>
      <p class="small">Protect profit via % / ATR / Fixed points. Simulated tick demo inside.</p>
      <div class="pill warn">Simulated</div>
    </article>

    <article class="card" onclick="openModal('indices')">
      <h3>All Index Data</h3>
      <p class="small">Nifty, Sensex, BankNifty, FinNifty (demo values)</p>
    </article>

    <article class="card" onclick="openModal('global')">
      <h3>Global Markets & Cues</h3>
      <p class="small">Brent / WTI / USDINR / GIFT Nifty / US indices (demo)</p>
    </article>

    <article class="card" onclick="openModal('news')">
      <h3>18-hour Breaking News</h3>
      <p class="small">Latest 18 hours market-moving headlines (demo).</p>
    </article>

    <article class="card" onclick="openModal('fiidi')">
      <h3>FII / DII Signals</h3>
      <p class="small">Institutional flows (demo hints).</p>
    </article>

    <article class="card" onclick="playBeep('buy')">
      <h3>Test Beeps</h3>
      <p class="small">Play Buy / Sell beep for alerts</p>
      <div style="margin-top:8px">
        <button class="btn" onclick="playBeep('buy');event.stopPropagation();">Buy Beep</button>
        <button class="btn" onclick="playBeep('sell');event.stopPropagation();">Sell Beep</button>
      </div>
    </article>

    <article class="card">
      <h3>Live Volume Indicator</h3>
      <p class="small"><span class="dot green" id="led-green"></span>Green = volume spike · <span class="dot red" id="led-red"></span>Red = drop</p>
    </article>
  </main>

  <section class="dua">
    <span>09:00</span>
    <marquee behavior="scroll" direction="left" style="padding-left:8px">
      In the name of Allah — Daily halal rizq dua (Hindi). Day1=original Day7; Day2=original Day3.
    </marquee>
  </section>

  <footer class="bbar">
    <button class="tab active">Home</button>
    <button class="tab">Watchlist</button>
    <button class="tab">Portfolio</button>
    <button class="tab">More</button>
  </footer>
</div>

<!-- MODAL -->
<div id="modal" class="modal hidden" role="dialog" aria-modal="true">
  <div class="modal-card">
    <div class="modal-head">
      <h3 id="modal-title">Title</h3>
      <button class="close" onclick="closeModal()">✕</button>
    </div>
    <div id="modal-body" class="modal-body">Content</div>
    <div class="modal-foot">
      <button class="btn ghost" onclick="closeModal()">Close</button>
    </div>
  </div>
</div>

<script>
/* ============================
   Demo data (all client-side)
   ============================ */
const DEMO = {
  indices:[
    {name:'NIFTY 50', symbol:'NIFTY50', value:24500.2, changePct:0.42},
    {name:'SENSEX', symbol:'SENSEX', value:80780.9, changePct:-0.15},
    {name:'BANK NIFTY', symbol:'BANKNIFTY', value:52450.1, changePct:0.31},
    {name:'FIN NIFTY', symbol:'FINNIFTY', value:23000.5, changePct:0.12}
  ],
  global:{
    us:{sp500:5600.12,dow:39850.3,nasdaq:17890.5},
    crude:{brent:86.2,wti:82.7},
    fx:{usdinr:83.05},
    gift:{value:24550.5,changePct:0.18},
    dollar:{dxy:103.8,changePct:-0.05}
  },
  halal:['TCS','INFY','HCLTECH','ITC','HDFCBANK','TITAN'],
  news:[
    {title:'Banking stocks rally as FII inflows rise', time: Date.now()-2*3600*1000, source:'DemoWire', sentiment:'positive'},
    {title:'Crude steady; markets eye policy', time: Date.now()-4*3600*1000, source:'DemoWire', sentiment:'neutral'},
    {title:'Regulatory action on midcap firm; index pares gains', time: Date.now()-6*3600*1000, source:'DemoWire', sentiment:'negative'}
  ],
  symbols:['TCS','INFY','HDFCBANK','ITC','RELIANCE','HCLTECH','ICICIBANK','AXISBANK','KOTAKBANK','SBIN']
};

/* ============================
   Splash -> Home
   ============================ */
window.addEventListener('load', () => {
  setTimeout(()=> {
    document.getElementById('splash').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    startVolumeLights();
  }, 3000);
});

/* ============================
   Modal helpers
   ============================ */
function openModal(key){
  const titleEl = document.getElementById('modal-title');
  const bodyEl = document.getElementById('modal-body');
  let html = '';
  if(key === 'gpt'){
    titleEl.textContent = 'GPT Power Indicator (demo)';
    const scored = computeGpt(DEMO.symbols);
    html += <p>Top 3 picks (simulated):</p><ol>${scored.top.map(s=><li><b>${s.symbol}</b> — score ${s.score} (${s.reason})</li>).join('')}</ol>;
    html += <p class="small">Rules combined: TA heuristics + volume boost + news sentiment demo. Avoid Mode: ${scored.avoidMode?'<b style="color:#a00">ON</b>':'<b style="color:#0a0">OFF</b>'}</p>;
    html += <div style="margin-top:10px"><button class="btn" onclick="playBeep(\\'buy\\')">Play Buy Beep</button> <button class="btn" onclick="playBeep(\\'sell\\')">Play Sell Beep</button></div>;
    bodyEl.innerHTML = html;
  } else if(key === 'halal'){
    titleEl.textContent = 'Halal Stock List';
    html += <p>Auto-updated 09:10 daily (demo):</p><ul>${DEMO.halal.map(s=><li>${s}</li>).join('')}</ul>;
    bodyEl.innerHTML = html;
  } else if(key === 'trail'){
    titleEl.textContent = 'Trailing Stop Loss (Simulator)';
    bodyEl.innerHTML = trailHtml();
    // must attach event listeners after injecting
    setTimeout(()=>attachTrailEvents(), 50);
  } else if(key === 'news'){
    titleEl.textContent = '18-hour Breaking News';
    html += <p>Showing last 18 hours (demo):</p>;
    html += DEMO.news.map(n=><div style="margin-bottom:10px"><b>${n.title}</b><div class="small">${n.source} • ${new Date(n.time).toLocaleString()}</div><div class="small">Sentiment: ${n.sentiment}</div></div>).join('');
    bodyEl.innerHTML = html;
  } else if(key === 'indices'){
    titleEl.textContent = 'All Index Data';
    html += <table class="table"><thead><tr><th>Index</th><th>Value</th><th>Change%</th></tr></thead><tbody>${DEMO.indices.map(i=><tr><td>${i.name}</td><td>${i.value}</td><td>${i.changePct>0?'+':''}${i.changePct}%</td></tr>).join('')}</tbody></table>;
    bodyEl.innerHTML = html;
  } else if(key === 'global'){
    titleEl.textContent = 'World Markets & Cues';
    const g=DEMO.global;
    html += <ul><li>Brent: ${g.crude.brent}</li><li>WTI: ${g.crude.wti}</li><li>USD/INR: ${g.fx.usdinr}</li><li>GIFT Nifty: ${g.gift.value} (${g.gift.changePct}%)</li><li>DXY: ${g.dollar.dxy}</li><li>US: S&P ${g.us.sp500}, Nasdaq ${g.us.nasdaq}</li></ul>;
    bodyEl.innerHTML = html;
  } else if(key === 'fiidi'){
    titleEl.textContent = 'FII / DII Activity (demo)';
    bodyEl.innerHTML = <ul><li>FII net inflow ↑ — banks, IT (demo)</li><li>DII net outflow — midcaps (demo)</li></ul>;
  } else {
    titleEl.textContent = 'Details'; bodyEl.innerHTML = '<p>Coming soon…</p>';
  }
  document.getElementById('modal').classList.remove('hidden');
}
function closeModal(){ document.getElementById('modal').classList.add('hidden'); }

/* ============================
   GPT Power (demo heuristic)
   ============================ */
function computeGpt(symbols){
  // Simple deterministic pseudo-scoring so results are stable across runs
  const seeded = (s) => s.split('').reduce((a,c)=>a + c.charCodeAt(0), 0);
  const scored = symbols.map(sym=>{
    const base = seeded(sym) % 80;
    const volBoost = (sym[0] < 'H') ? 8 : 0;
    const newsBoost = (Math.random() > 0.7) ? 6 : 0; // occasional news bump
    const score = Math.min(99, Math.max(10, base + volBoost + newsBoost));
    const reason = (volBoost? 'Volume boost' : 'Sector strength') + (newsBoost? ' + news' : '');
    return { symbol: sym, score, reason };
  }).sort((a,b)=>b.score-a.score);
  const top = scored.slice(0,3);
  const avoidMode = top[0].score < 60; // safety rule
  return { top, all:scored, avoidMode };
}

/* ============================
   Trailing SL UI & logic
   ============================ */
function trailHtml(){
  return `
  <div style="display:grid;gap:8px">
    <div style="display:flex;gap:8px">
      <label>Mode
        <select id="trail-mode" class="small">
          <option value="percent">Percentage (%)</option>
          <option value="atr">ATR x Multiplier</option>
          <option value="points">Fixed Points</option>
        </select>
      </label>
      <label id="val-label">Value
        <input id="trail-value" type="number" value="2" step="0.1" style="width:80px"/>
      </label>
      <label>Entry
        <input id="trail-entry" type="number" value="100" step="0.1" style="width:110px"/>
      </label>
      <label>High
        <input id="trail-high" type="number" value="100" step="0.1" style="width:110px"/>
      </label>
    </div>
    <div class="small">ATR (demo) will be estimated from mock candles when ATR mode selected.</div>
    <div style="display:flex;gap:8px">
      <button class="btn" id="tick-up">Tick ↑</button>
      <button class="btn" id="tick-down">Tick ↓</button>
      <button class="btn" id="reset-trail">Reset</button>
    </div>
    <div style="margin-top:8px">
      <div>Current Price: <b id="price">100</b></div>
      <div>Highest since entry: <b id="highest">100</b></div>
      <div>Trailing Stop: <b id="stop" style="color:#a00">98.00</b></div>
    </div>
    <small class="small">Rule: trailing stop moves up with new peaks; it never moves down.</small>
  </div>
  `;
}

/* Trailing utility functions (client-side) */
function computeATRfromMock(candles, period=14){
  if(!candles || candles.length < period+1) return 1.2;
  const trs = [];
  for(let i=1;i<candles.length;i++){
    const tr = Math.max(
      Math.abs(candles[i].h - candles[i].l),
      Math.abs(candles[i].h - candles[i-1].c),
      Math.abs(candles[i].l - candles[i-1].c)
    );
    trs.push(tr);
  }
  const slice = trs.slice(-period);
  const avg = slice.reduce((a,b)=>a+b,0) / slice.length;
  return avg;
}

function attachTrailEvents(){
  // mock candles for ATR
  const candles = Array.from({length:30},(_,i)=>{
    const base = 90 + i*0.5 + (Math.random()-0.5)*2;
    const h = +(base + Math.random()*2).toFixed(2);
    const l = +(base - Math.random()*2).toFixed(2);
    const c = +(l + Math.random()*(h-l)).toFixed(2);
    return {h,l,c};
  });
  const atr = computeATRfromMock(candles,14);

  let state = { highest: parseFloat(document.getElementById('trail-high').value||100),
                stop: parseFloat((parseFloat(document.getElementById('trail-entry').value||100) * 0.98).toFixed(2)) };
  let price = parseFloat(document.getElementById('trail-entry').value||100);

  function updateUI(){
    document.getElementById('price').textContent = price.toFixed(2);
    document.getElementById('highest').textContent = state.highest.toFixed(2);
    document.getElementById('stop').textContent = state.stop.toFixed(2);
  }
  function nextStop(mode, value, priceNow){
    state.highest = Math.max(state.highest, priceNow);
    if(mode === 'percent'){
      const candidate = +(state.highest * (1 - value/100)).toFixed(2);
      state.stop = Math.max(state.stop, candidate);
    } else if(mode === 'points'){
      const candidate = +(state.highest - value).toFixed(2);
      state.stop = Math.max(state.stop, candidate);
    } else if(mode === 'atr'){
      const candidate = +(state.highest - (value * atr)).toFixed(2);
      state.stop = Math.max(state.stop, candidate);
    }
    return state.stop;
  }

  document.getElementById('tick-up').onclick = () => {
    price = +(price + (Math.random()*2)).toFixed(2);
    const mode = document.getElementById('trail-mode').value;
    const value = parseFloat(document.getElementById('trail-value').value||2);
    nextStop(mode, value, price);
    updateUI();
  };
  document.getElementById('tick-down').onclick = () => {
    price = +(price - (Math.random()*2)).toFixed(2);
    // stop does not move down by rule
    updateUI();
  };
  document.getElementById('reset-trail').onclick = () => {
    const entry = parseFloat(document.getElementById('trail-entry').value||100);
    state = { highest: entry, stop: +(entry * 0.98).toFixed(2) };
    price = entry;
    updateUI();
  };

  // initial UI
  updateUI();

  // change label depending on mode
  document.getElementById('trail-mode').onchange = () => {
    const mode = document.getElementById('trail-mode').value;
    const label = document.getElementById('val-label');
    if(mode === 'percent') label.innerHTML = 'Value <input id="trail-value" type="number" value="2" step="0.1" style="width:80px"/>';
    else if(mode === 'atr') label.innerHTML = 'ATR x <input id="trail-value" type="number" value="1.5" step="0.1" style="width:80px"/>';
    else label.innerHTML = 'Points <input id="trail-value" type="number" value="5" step="0.1" style="width:80px"/>';
  };
}

/* ============================
   Audio beeps for alerts
   ============================ */
function playBeep(kind='buy'){
  try{
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator(), g = ctx.createGain();
    o.type = 'sine';
    o.frequency.value = kind === 'buy' ? 880 : 440;
    g.gain.setValueAtTime(0.0001, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.25);
    o.connect(g).connect(ctx.destination);
    o.start(); o.stop(ctx.currentTime + 0.26);
  } catch(e) { console.warn('Audio not available', e); }
}

/* ============================
   Volume indicator demo
   ============================ */
function startVolumeLights(){
  const g = document.getElementById('led-green');
  const r = document.getElementById('led-red');
  setInterval(()=> g.style.opacity = (Math.random() > 0.5 ? 1 : 0.2), 1200);
  setInterval(()=> r.style.opacity = (Math.random() > 0.7 ? 1 : 0.2), 1500);
}

/* ============================
   No auto-close logic included
   ============================ */

/* ============================
   Utility: prevent modal button clicks closing parent
   ============================ */
/* nothing extra needed for now */

</script>
</body>
</html>
