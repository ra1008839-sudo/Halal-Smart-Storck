<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Halal Smart Stock</title>
<style>
  :root{
    --brand:#0e7a34; --bg:#f6f7fb; --card:#ffffff; --border:#e5e7eb; --muted:#6b7280;
    --danger:#ef4444; --ok:#22c55e;
  }
  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto}
  .hidden{display:none}

  /* Splash */
  .splash{display:flex;align-items:center;justify-content:center;height:100vh;background:var(--brand)}
  .splash-card{background:#fff;color:var(--brand);border-radius:26px;padding:36px 44px;box-shadow:0 12px 34px rgba(0,0,0,.18);text-align:center}
  .splash-card h1{margin:0 0 6px;font-size:44px}
  .splash-card p{margin:0;font-weight:600}

  /* App shell */
  .app{min-height:100vh;background:var(--bg);display:flex;flex-direction:column}
  .topbar{position:sticky;top:0;background:#fff;border-bottom:1px solid #e9e9ef;padding:12px 16px;z-index:5}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:var(--brand);color:#fff;font-weight:800}
  .titles h2{margin:0;font-size:18px}
  .titles small{color:var(--muted)}

  .quick{display:flex;gap:8px;padding:10px 12px;overflow:auto}
  .btn{border:1px solid #d4d7dd;background:#fff;border-radius:12px;padding:8px 12px;font-weight:600;cursor:pointer}
  .btn:hover{background:#f0f3f7}
  .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
  .btn.ghost{background:#fff}

  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;padding:12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;cursor:pointer;transition:transform .08s, box-shadow .2s}
  .card:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.06)}
  .card h3{margin:0 0 6px}
  .pill{display:inline-block;padding:3px 8px;border-radius:999px;font-size:12px;margin-top:6px}
  .pill.ok{background:#e6f7ed;color:var(--brand)}
  .pill.warn{background:#fff6e5;color:#a05d00}
  .dot{display:inline-block;width:10px;height:10px;border-radius:50%;vertical-align:middle;margin-right:4px}
  .dot.green{background:var(--ok)} .dot.red{background:var(--danger)}

  .dua{margin:8px 12px;background:var(--brand);color:#fff;border-radius:12px;padding:8px 10px;display:flex;gap:8px;align-items:center}
  .dua span{background:#fff;color:var(--brand);border-radius:8px;padding:2px 6px;font-weight:700}

  .bbar{position:sticky;bottom:0;background:#fff;border-top:1px solid #e9e9ef;display:flex;justify-content:space-around;padding:8px}
  .tab{background:none;border:none;padding:8px 10px;font-weight:700}
  .tab.active{color:var(--brand)}

  /* Modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;padding:16px}
  .modal-card{background:#fff;border-radius:16px;max-width:560px;width:100%;box-shadow:0 16px 40px rgba(0,0,0,.18);overflow:hidden}
  .modal-head{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid #eee}
  .modal-body{padding:14px;max-height:60vh;overflow:auto}
  .modal-foot{display:flex;gap:10px;justify-content:flex-end;padding:12px 14px;border-top:1px solid #eee}
  .close{border:none;background:#f3f4f6;border-radius:10px;padding:6px 10px;cursor:pointer}

  /* Session overlay (auto-close) */
  .overlay{position:fixed;inset:0;background:rgba(255,255,255,.96);display:flex;align-items:center;justify-content:center;padding:20px;text-align:center}
  .overlay-box{max-width:520px}
  .muted{color:var(--muted);font-size:14px}
</style>
</head>
<body>

<!-- SPLASH (3 sec) -->
<section id="splash" class="splash">
  <div class="splash-card">
    <h1>Bismillah</h1>
    <p>Halal Smart Stock</p>
  </div>
</section>

<!-- APP -->
<div id="app" class="app hidden">
  <header class="topbar">
    <div class="brand">
      <div class="logo">H</div>
      <div class="titles">
        <h2>Halal Smart Stock</h2>
        <small>where imaan meets investing</small>
      </div>
    </div>
  </header>

  <!-- Quick actions -->
  <div class="quick">
    <button class="btn" onclick="openCard('gpt')">GPT Power</button>
    <button class="btn" onclick="openCard('halal')">Halal List</button>
    <button class="btn" onclick="openCard('trail')">Trailing SL</button>
    <button class="btn" onclick="openCard('news')">News</button>
    <button class="btn" onclick="openCard('fiidi')">FII/DII</button>
    <button class="btn" onclick="openCard('volume')">Volume</button>
  </div>

  <!-- Cards grid -->
  <main class="grid">
    <article class="card" onclick="openCard('gpt')">
      <h3>GPT Power Indicator</h3>
      <p>Top 3 buy-ready at <b>09:05</b> daily.</p>
      <ul>
        <li>Technicals + Fundamentals</li>
        <li>News Sentiment + Social Buzz</li>
        <li>Volume & FII/DII + Sector check</li>
      </ul>
    </article>

    <article class="card" onclick="openCard('halal')">
      <h3>Halal (Shariah) Stock List</h3>
      <p>Auto-updated <b>09:10</b> daily.</p>
      <div class="pill ok">Compliant</div>
    </article>

    <article class="card" onclick="openCard('trail')">
      <h3>Trailing Stop Loss</h3>
      <p>Protect profits with % / ATR / fixed points.</p>
      <div class="pill warn">Simulated</div>
    </article>

    <article class="card" onclick="openCard('volume')">
      <h3>Live Volume Indicator</h3>
      <p><span class="dot green"></span> Green = spike, <span class="dot red"></span> Red = drop.</p>
    </article>

    <article class="card" onclick="openCard('news')">
      <h3>News & Sentiment</h3>
      <p>Realtime feed (demo). Avoid Mode if negative.</p>
    </article>

    <article class="card" onclick="openCard('fiidi')">
      <h3>FII / DII Signals</h3>
      <p>Early-move detector (informational).</p>
    </article>
  </main>

  <!-- Dua strip -->
  <section class="dua">
    <span>09:00</span>
    <marquee behavior="scroll" direction="left">
      In the name of Allah — Daily halal rizq dua (Hindi text). Day1=original Day7; Day2=original Day3.
    </marquee>
  </section>

  <footer class="bbar">
    <button class="tab active">Home</button>
    <button class="tab">Watchlist</button>
    <button class="tab">Portfolio</button>
    <button class="tab">More</button>
  </footer>
</div>

<!-- Modal -->
<div id="modal" class="modal hidden" role="dialog" aria-modal="true">
  <div class="modal-card">
    <div class="modal-head">
      <h3 id="modal-title">Title</h3>
      <button class="close" onclick="closeModal()">✕</button>
    </div>
    <div id="modal-body" class="modal-body">Content</div>
    <div class="modal-foot">
      <button class="btn ghost" onclick="closeModal()">Close</button>
      <button class="btn primary" onclick="demoAction()">Demo Action</button>
    </div>
  </div>
</div>

<!-- Session overlay (auto-close) -->
<div id="overlay" class="overlay hidden">
  <div class="overlay-box">
    <h2>Session Ended</h2>
    <p class="muted">For security and stability, the app auto-closes after a fixed duration.</p>
    <p class="muted">You can start a fresh session now.</p>
    <button class="btn primary" onclick="restartSession()">Restart Session</button>
  </div>
</div>

<script>
/* --------- Splash -> Home (3s) --------- */
window.addEventListener("load", () => {
  setTimeout(() => {
    document.getElementById("splash").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    startVolumeTicker();
    scheduleAutoClose(); // start session timer
  }, 3000);
});

/* --------- Modal + Views --------- */
const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modal-title");
const modalBody = document.getElementById("modal-body");

function openCard(key){
  const views = {
    gpt: {
      title: "GPT Power Indicator",
      body: `
        <p>Daily Top-3 (09:05): <b>ABC Ltd</b>, <b>XYZ Finance</b>, <b>MNO Pharma</b> (demo)</p>
        <ul>
          <li>Signals combine: TA + FA + News + Volume + FII/DII + Sector + Social</li>
          <li>Avoid Mode triggers when any safety rule fails</li>
        </ul>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" onclick="playBeep('buy')">Play Buy Beep</button>
          <button class="btn" onclick="playBeep('sell')">Play Sell Beep</button>
        </div>`
    },
    halal: {
      title: "Halal Stock List",
      body: `
        <p>Auto-updated 09:10 daily (demo set):</p>
        <ol><li>TCS</li><li>INFY</li><li>HCLTECH</li><li>ITC</li></ol>
        <p>Export: CSV/PDF (wire to backend later).</p>`
    },
    trail: {
      title: "Trailing Stop Loss",
      body: `
        <p>Modes: Percentage / ATR / Fixed points.</p>
        <label>Mode:
          <select id="trail-mode">
            <option>Percentage</option><option>ATR</option><option>Fixed</option>
          </select>
        </label>
        <label>Value: <input id="trail-val" type="number" step="0.1" value="2"> </label>
        <label>Auto-exit: <input id="trail-exit" type="checkbox" checked></label>
        <p><i>Simulated for now — connect to broker webhook for live orders.</i></p>`
    },
    news: {
      title: "News & Sentiment",
      body: `
        <p>Realtime feed (demo):</p>
        <ul><li>Positive — ABC raises guidance; sector tailwinds</li>
            <li>Neutral — RBI policy unchanged</li>
            <li>Negative — Regulatory fine on PQR (Avoid Mode)</li></ul>`
    },
    fiidi: {
      title: "FII/DII Activity",
      body: `
        <p>Early-move probability (demo):</p>
        <ul><li>FII net inflow ↑ — banks, IT</li>
            <li>DII net outflow — midcaps</li></ul>`
    },
    volume: {
      title: "Live Volume Indicator",
      body: <p>Green flash = spike; Red flash = drop. Auto-tighten rule available for Trail SL.</p>
    }
  };

  modalTitle.textContent = views[key]?.title || "Details";
  modalBody.innerHTML = views[key]?.body || "Coming soon…";
  modal.classList.remove("hidden");
}
function closeModal(){ modal.classList.add("hidden"); }
function demoAction(){ alert("Demo action executed."); }

/* --------- Demo LEDs --------- */
function startVolumeTicker(){
  const greenDots = document.querySelectorAll(".dot.green");
  const redDots = document.querySelectorAll(".dot.red");
  setInterval(() => greenDots.forEach(g => g.style.opacity = (Math.random()>.5?1:0.25)), 1200);
  setInterval(() => redDots.forEach(r => r.style.opacity = (Math.random()>.5?1:0.25)), 1500);
}

/* --------- Buy/Sell beeps (WebAudio) --------- */
function playBeep(kind="buy"){
  try{
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    const o = ctx.createOscillator(); const g = ctx.createGain();
    o.type = "sine";
    o.frequency.value = (kind==="buy") ? 880 : 440;
    g.gain.setValueAtTime(0.0001, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.25);
    o.connect(g).connect(ctx.destination);
    o.start(); o.stop(ctx.currentTime + 0.26);
  }catch(e){ console.log("Audio not supported", e); }
}

/* --------- Auto-close session (2–4 hours) --------- */
function getHoursFromQuery(){
  const params = new URLSearchParams(location.search);
  const h = parseFloat(params.get("hours"));
  if(!isNaN(h) && h>=2 && h<=4) return h;
  return 3; // default 3 hours
}
function scheduleAutoClose(){
  const hours = getHoursFromQuery();
  const ms = hours * 60 * 60 * 1000;
  console.log(Session will auto-close in ${hours}h);
  setTimeout(showSessionOverlay, ms);
}
function showSessionOverlay(){
  document.getElementById("overlay").classList.remove("hidden");
  // Optionally, stop interactions:
  document.getElementById("app").style.filter = "grayscale(1)";
  document.getElementById("app").style.pointerEvents = "none";
}
function restartSession(){ location.reload(); }
</script>
</body>
</html>
